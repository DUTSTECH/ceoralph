{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Context Package",
  "description": "Context package sent to Codex workers",
  "type": "object",
  "required": ["taskId", "task", "files"],
  "properties": {
    "taskId": {
      "type": "string",
      "description": "Task identifier"
    },
    "task": {
      "type": "object",
      "description": "Full task definition",
      "properties": {
        "title": { "type": "string" },
        "do": { "type": "string" },
        "doneWhen": { "type": "string" },
        "acceptance": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    },
    "files": {
      "type": "object",
      "description": "Relevant file contents",
      "additionalProperties": {
        "type": "object",
        "properties": {
          "path": { "type": "string" },
          "content": { "type": "string" },
          "language": { "type": "string" },
          "relevantSections": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "startLine": { "type": "integer" },
                "endLine": { "type": "integer" },
                "description": { "type": "string" }
              }
            }
          }
        }
      }
    },
    "design": {
      "type": "object",
      "description": "Relevant design decisions",
      "properties": {
        "architecture": { "type": "string" },
        "patterns": {
          "type": "array",
          "items": { "type": "string" }
        },
        "apis": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "endpoint": { "type": "string" },
              "method": { "type": "string" },
              "description": { "type": "string" }
            }
          }
        }
      }
    },
    "constraints": {
      "type": "array",
      "items": { "type": "string" },
      "description": "Constraints and rules to follow"
    },
    "previousAttempts": {
      "type": "array",
      "description": "Feedback from previous attempts",
      "items": {
        "type": "object",
        "properties": {
          "attempt": { "type": "integer" },
          "feedback": { "type": "string" },
          "issues": {
            "type": "array",
            "items": { "type": "string" }
          }
        }
      }
    },
    "workingDirectory": {
      "type": "string",
      "description": "Working directory for the task"
    },
    "commitPrefix": {
      "type": "string",
      "description": "Commit message prefix"
    }
  }
}
